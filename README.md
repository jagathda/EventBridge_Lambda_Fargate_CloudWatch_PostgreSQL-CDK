# EventBridge_Lambda_Fargate_CloudWatch_PostgreSQL-CDK

This project demonstrates an AWS event-driven architecture that integrates **AWS EventBridge**, **Lambda**, **ECS Fargate**, **CloudWatch**, and **PostgreSQL (RDS)**. The architecture triggers a Docker container running on Fargate, logs the event data to **CloudWatch**, and stores the event data in a **PostgreSQL RDS** table.

## Prerequisites

Ensure the following are available before you start:

- **AWS Account**: An active AWS account with proper IAM permissions.
- **AWS CLI**: Installed and configured on your local machine.
- **AWS CDK**: Installed globally (`npm install -g aws-cdk`).
- **Docker**: Installed to build and manage Docker images.
- **PostgreSQL Client**: Optional, used for manual verification of data in the PostgreSQL database.

## Steps to Deploy

### 1. Clone the Repository

Begin by cloning the repository to your local development environment:

```bash
git clone https://github.com/jagathda/EventBridge_Lambda_Fargate_CloudWatch_PostgreSQL-CDK.git
cd EventBridge_Lambda_Fargate_CloudWatch_PostgreSQL-CDK
```

### 2. Build and Push Docker Image

I. **Build the Docker image** that will be used in the ECS Fargate task:

   ```bash
   docker build -t message-logger .
   ```

II. **Authenticate Docker with ECR** (you must replace `<aws-region>` and `<aws-account-id>` with your own AWS region and account ID):

   ```bash
   aws ecr get-login-password --region <aws-region> | docker login --username AWS --password-stdin <aws-account-id>.dkr.ecr.<aws-region>.amazonaws.com
   ```

III. **Tag the Docker image** for the ECR repository (replace `<aws-account-id>` and `<aws-region>` with your details):

   ```bash
   docker tag message-logger:latest <aws-account-id>.dkr.ecr.<aws-region>.amazonaws.com/message-logger:latest
   ```

IV. **Push the Docker image** to your ECR repository:

   ```bash
   docker push <aws-account-id>.dkr.ecr.<aws-region>.amazonaws.com/message-logger:latest
   ```

### 3. Deploy the CDK Stack

Ensure your AWS CLI is properly configured with the required credentials. Then, run the following commands to synthesize and deploy the CloudFormation stack:

```bash
cdk synth
cdk deploy
```

This will provision all necessary AWS resources, including the VPC, ECS Cluster, Fargate tasks, PostgreSQL RDS, Lambda function, and EventBridge rule.

### 4. Test the Event

Once the stack is deployed, you can test the setup by sending an event to EventBridge. Use the following AWS CLI command:

```bash
aws events put-events --entries file://test_event.txt
```

### 5. View Logs

I. **Check the logs generated by the ECS Fargate task in CloudWatch**:

Run the following command to describe log streams:

```bash
aws logs describe-log-streams --log-group-name /ecs/MyApp
```

II. **View the logs** to confirm that the event payload and event type were logged.

### 6. Verify PostgreSQL Insertion

I. **Connect to your PostgreSQL RDS instance** to ensure the event data has been successfully inserted into the `events_log` table.

```sql
SELECT * FROM events_log;
```

### Cleanup

To avoid incurring ongoing AWS charges, destroy the CDK stack once you are done with testing:

```bash
cdk destroy
```
